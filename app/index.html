<!doctype html>
<html ng-app="primate">
<head>
    <meta charset="utf-8">
    <title>Primate</title>
    <link rel="stylesheet" href="css/main.css">
    <script src="bower_components/angular/angular.js"></script>
	<script src="js/libpwsafejs/jDataView/jquery/jquery-1.7.1-binary-ajax.js"></script>
	<script src="js/libpwsafejs/jDataView/src/jdataview.js"></script>
	<script src="js/libpwsafejs/jDataView/src/jdataview-jquery-converter.js"></script>
	<script src="js/libpwsafejs/crypto-sha256-hmac.js"></script>
	<script src="js/libpwsafejs/twofish.js"></script>
	<script src="js/libpwsafejs/pwsafedb.js"></script>
	<script src="bower_components/zxcvbn/zxcvbn.js"></script>
	<script src="js/app.js"></script>
	<script src="js/factories.js"></script>
	<script src="js/services.js"></script>
	<script src="js/filters.js"></script>
	<script src="js/controllers.js"></script>
</head>
<body ng-controller="StateController">
    <h1>Primate Password Manager</h1>

	<div ng-controller="FilePicker" ng-if="state == 'unloaded'">
		<p>Open Password Database File</p>
		<input type="file" value="Open Password Database" id="fileInput">
		<input type="button" value="New Database">
		<p>Password: <input type="password" ng-model="pass"></p>
		<input type="button" value="Open" ng-click="open()">
		<p ng-show="invalidFile">Invalid Password Database</p>
	</div>

	<div ng-if="viewing" id="viewBox">
		<fieldset>
			<form name="form">
				<legend>Record</legend><br>
				<label>ID&nbsp;:</label> 
				<input type="text" size="30" ng-model="currentRecord.uuid"><br><br>
				<label>Title&nbsp;:</label> 
				<input type="text" size="30" ng-model="currentRecord.title"><br><br>
				<label>Group&nbsp;:</label> 
				<input type="text"  size="30" ng-model="currentRecord.group"><br><br>
				<label>UserName&nbsp;:</label> 
				<input type="text"  size="30" ng-model="currentRecord.username"><br><br>
				<label>Notes&nbsp;:</label>
				<input type="text"  size="30" ng-model="currentRecord.notes"><br><br>
				<label>Password&nbsp;:</label> 
				<input type="text"  size="30" ng-model="currentRecord.password"><br><br>
				<label>CreateTime&nbsp;:</label>
				<input type="date"  size="30" ng-model="currentRecord.createTime"><br><br>
				<label>PassPhraseModifyTime&nbsp;:</label> 
				<input type="text"  size="30" ng-model="currentRecord.passphraseModifyTime"><br><br>
				<label>ModifyTime&nbsp;:</label>
				<input type="text"  size="30" ng-model="currentRecord.modifyTime"><br><br>
				<label>URL&nbsp;:</label> 
				<input type="text"  size="30" ng-model="currentRecord.URL"><br><br>
				<label>Autotype&nbsp;:</label> 
				<input type="text"  size="30" ng-model="currentRecord.autotype"><br><br>
				<label>History&nbsp;:</label>
				<input type="checkbox"  size="30" ng-model="checked" ng-init="checked=currentRecord.passphraseHistory.isEnabled"><br>
				<div ng-if="checked" class="animate-if">
					<p ng-if="!currentRecord.passphraseHistory.isEnabled" class="animate-if">No History!</p>
					<div ng-if="!!currentRecord.passphraseHistory.isEnabled">
						<label>Passphrases&nbsp;:</label>
						<p ng-repeat="pastphrase in currentRecord.passphraseHistory.passphrases" class="animate-if">{{pastphrase.passphrase}} ({{pastphrase.timestamp}})</p>
					</div>
				</div>
			</form>
		</fieldset>		
		<input type="button" value="Close" ng-click="closeView()">
	</div>
	
	<div ng-if="state == 'loaded'">
		<input type="button" ng-click="closeDb()" value="Close Database">

		<h4>Accounts</h4>
		<table>
			<tr>
				<th>Name</th>
				<th>Password</th>
				<th>Strength</th>
				<th>Show?</th>
			</tr>
			<tr ng-repeat="record in records">
				<td><a href="" ng-click="viewRecord(record.uuid)">{{record.title}}</a></td>
				<td ng-switch on="showPw">
					<span ng-switch-when="true">{{record.password}}</span>
					<span ng-switch-default>{{record.password | hash}}</span>
				</td>
				<td>{{record.password | passwordStrengthScore}}</td>
				<td><input type="checkbox" ng-model="showPw"></td>
			</tr>
		</table>
	</div>


</body>
</html>
